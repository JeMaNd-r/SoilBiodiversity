
```{r setting, echo=FALSE}
print(paste0("Last updated: " ,Sys.Date())
```


# Soil Biodiversity across Europe based on SDMs

The following code used occurrence data and environmental variables to predict Species Distribution Models (SDMs) for soil organisms across Europe.


## Description

Belowground biodiversity does not necessarily follow aboveground biodiversity patterns, but maps of soil biodiversity remain scarce because of limited data availability. Earthworms belong to the most thoroughly studied soil organisms, and  - in their role as ecosystem engineers - have a significant impact on ecosystem functioning. Here, we address the questions where and what is needed to protect European earthworm species. We focus on highly recorded species only, that is on species with broad geographic ranges and therefore an appropriate number of occurrence records in Europe (min. XX records). First, we map the spatial distribution of common earthworm species and the respective total species richness (i.e., number of species with a probability of presence above 60%). We use multiple environmental predictors spanning climatic, edaphic, and topological factors. In accordance with the literature, we predicted potential species distributions by well-performing models (i.e., MaxEnt, BRT, RF-downsized, and Ensemble modeling) (Valavi et al. 2021). Second, we investigate how well the different types of protected areas cover mean and individual species ranges by estimating the respective proportion of range area. Based on the protection coverage, we are able to identify vulnerable species, that is species whose ranges only sparsely overlap with current protected areas. 

## Getting Started

### Dependencies

* Windows 10
* R version 4.1.2
* RStudio version 1.2.5033

R packages

```{r Rpackages, echo=FALSE}
sessionInfo()
```


### Installing

* Code is available at GitHub.
* Data can be downloaded according to Zeiss et al. 2023.

Folder structure should be maintained. Additionally, please start with loading the SoilBiodiversity.Rproj file, and load individual R scripts from there. Working directory should be the SoilBiodiversity folder containing the .Rproj file. This is necessary to access all data files that will be called with `here::here()`.


### Executing program

* Open the RMarkdown document called *SoilBiodiversity_SDMs.Rmd*.
* Follow its written workflow and load the attached R scripts.

If any of the individual R scripts doesn't run when using `load()`, please run the whole scripts manually. Open the respective R file (.R), select all lines, and run them in the console. 


## Help

You may need to download the spatial grid (*grid_2k_0p016.tif*) into the *data* subfolder, as well as the raster stack(s) of environmental variables (*EnvPredictor_2km...*) into the *results* subfolder.


## Authors

Contributors names and contact info

Romy Zeiss  
[@RomyZeiss](https://twitter.com/romyzeiss)

## Version History

* 0.2
    * Various bug fixes and optimizations
    * See [commit change]() or See [release history]()
* 0.1
    * Initial Release

## License

This project is licensed under the MIT License - see the LICENSE.md file for details.

## Acknowledgments

This code is based on Valavi et al. 2021 [1]



## References

[1] Valavi et al. (2021) Predictive performance of presence-only species distribution models: a benchmark study with reproducible code. Ecological Mponographs.

[2]



## Folder structure

#### data

*Note* Species occurrence data downloaded from diverse sources. GBIF data with search term "Crassiclitellata" is available at [https://doi.org/10.15468/dl.ghtngj]. Date 2022-03-05. GBIF Download content: metadata, and occurrence records (occurrence.txt). Data compiled by Jérome Mathieu is available upon request and will be published separately. Version date: 2022-05-20.

* Edaphobase_download_24-Feb-2021_Lumbricidae_Europe.csv
  * Species occurrence data downloaded from Edaphobase, search term "Lumbricidae". Date 2022-01-25. After download but before data processing, we manually changed ö/ä/ü/ß into oe/ae/ue/ss.

* SiteData_sWorm_v2.csv
  * Coordinates associated with sites in species occurrence data from global sWorm project. Download: 2021-06-14. Publication: Phillips et al. (2021). Global data on earthworm abundance, biomass, diversity and corresponding environmental properties. Scientific Data, 8(1), 1-12.

* SoilReCon_earthworms_clean.csv
  * Species occurrence data from SoilReCon project in Portugal. Version date: 2022-05-20. Data creator: Carlos A. Guerra and Concha Cano Diaz.

* Species_list_Crassiclitellata.csv
  * Table with raw species names, their accepted taxon names, ecological grouping, and abbreviations.

* Species_list_Crassiclitellata_short.csv
  * Table with accepted species names and abbreviations of species with >= 10 records only.

* SppOccData_sWorm_v2.csv
  * Species occurrence data from global sWorm project with site names. Download: 2021-06-14. Publication: Phillips et al. (2021). Global data on earthworm abundance, biomass, diversity and corresponding environmental properties. Scientific Data, 8(1), 1-12.


#### doc

* Add_Bottinelli_ecogroups.R
  * R script to identify accepted taxonomic names (based on taxize package & ITIS database) and ecological groups (based on Bottinelli and Bouché).

* Bottinelli_2020_Earthworm_classification.csv
  * Supplementary data from Bottinelli 2020 containing species names and their ecological grouping.

* ODMAP_Zeiss_et_al_2022-09-15.csv
  * ODMAP protocol summarizing settings and input data of Species Distribution Modeling. Version: 2022-09-15.

#### intermediates

* Earthworm_occurrence_GBIF-sWorm-Edapho-SoilReCon.csv
  * Species occurrence data cleaned and compiled from single datasets. Please note that the dataset compiled by Jérome Mathieu (JM) had to be excluded. The full processed dataset is avaiable upon request.

#### results

* corMatPearson_predictors.csv
  * Correlation matrix showing Pearson correlations among the predictors (i.e., environmental variables) at 2km resolution.

* corMatSpearman_predictors.csv
  * Correlation matrix showing Spearman correlations among the predictors (i.e., environmental variables) at 2km resolution.

* EnvPredictor_2km.grd/.gri
  * Raster stack where each layer represents one environmental variable at ~2km² resolution within the European raster grid.

* EnvPredictor_2km_df_normalized.RData
  * Dataframe where each column represents one scaled environmental variable at ~2km² resolution within the European raster grid.

* EnvPredictor_2km_normalized.grd/.gri
  * Raster stack where each layer represents one scaled environmental variable at ~2km² resolution within the European raster grid.

* EnvPredictor_5km.grd/.gri
  * Raster stack where each layer represents one environmental variable at ~5km² resolution within the European raster grid.

* EnvPredictor_5km_normalized.grd/.gri
  * Raster stack where each layer represents one scaled environmental variable at ~5km² resolution within the European raster grid.

* EnvPredictor_5km_df_normalized.RData
  * Dataframe where each column represents one scaled environmental variable at ~5km² resolution within the European raster grid.

* 
